"use strict";var HexoSearch,SearchService="";!function(t){SearchService=function(){var a=this;a.config=t.extend({per_page:10,selectors:{body:"body",form:".u-search-form",input:".u-search-input",container:"#u-search",modal:"#u-search .modal",modal_body:"#u-search .modal-body",modal_overlay:"#u-search .modal-overlay",modal_results:"#u-search .modal-results",modal_loading_bar:"#u-search .modal-loading-bar",modal_ajax_content:"#u-search .modal-ajax-content",btn_close:"#u-search .btn-close"}}),a.dom={},a.percentLoaded=0,a.open=!1,a.queryText="",a.parseSelectors=function(){for(var e in a.config.selectors)a.dom[e]=t(a.config.selectors[e])},a.beforeQuery=function(){a.open||(a.open=!0,a.dom.container.fadeIn(),a.dom.body.addClass("modal-active"),a.dom.body.keydown(function(e){9==e.keyCode&&e.preventDefault()})),a.dom.input.each(function(e,o){t(o).val(a.queryText)}),document.activeElement.blur(),a.dom.modal_ajax_content.removeClass("loaded"),a.startLoading()},a.afterQuery=function(){a.dom.modal_body.scrollTop(0),a.dom.modal_ajax_content.addClass("loaded"),a.stopLoading()},a.search=function(e,o){a.beforeQuery(),a.search instanceof Function?a.query(a.queryText,e,function(){a.afterQuery()}):(console.error("query() does not exist."),a.onQueryError(a.queryText,""),a.afterQuery())},a.buildResult=function(e,o,a){var t="<li>";return(t+='<a class="result" href="'.concat(e,'">'))+'<span class="title">'.concat(o,"</span>")+'<span class="digest">'.concat(a,"</span>")+"<span class='fas fa-chevron-thin-right'></span>"+"</a>"+"</li>"},a.close=function(){a.open=!1,a.dom.container.fadeOut(),a.dom.body.removeClass("modal-active"),a.dom.body.unbind("keydown")},a.onSubmit=function(e){e.preventDefault(),a.queryText=t(this).find(".u-search-input").val(),a.queryText&&a.search(1)},a.startLoading=function(){a.dom.modal_loading_bar.show(),a.loadingTimer=setInterval(function(){a.percentLoaded=Math.min(a.percentLoaded+5,95),a.dom.modal_loading_bar.css("width",a.percentLoaded+"%")},100)},a.stopLoading=function(){clearInterval(a.loadingTimer),a.dom.modal_loading_bar.css("width","100%"),a.dom.modal_loading_bar.fadeOut(),setTimeout(function(){a.percentLoaded=0,a.dom.modal_loading_bar.css("width","0%")},300)},a.destroy=function(){a.dom.form.each(function(e,o){t(o).off("submit")}),a.dom.modal_ajax_content.off("click"),a.dom.modal_overlay.off("click"),a.dom.btn_close.off("click"),a.dom.container.remove()},a.init=function(){t("body").append(e),a.parseSelectors(),a.dom.form.each(function(e,o){t(o).on("submit",a.onSubmit)}),a.dom.modal_ajax_content.on("click",a.close),a.dom.modal_overlay.on("click",a.close),a.dom.btn_close.on("click",a.close)},a.init()};var e='<div id="u-search"><div class="modal"><header class="modal-header"><form id="u-search-modal-form" class="u-search-form" name="uSearchModalForm"><input type="text" id="u-search-modal-input" class="u-search-input"/><button type="submit" id="u-search-modal-btn-submit" class="u-search-btn-submit"><span class="fas fa-search"></span></button></form><a class="btn-close"><span class="fas fa-times"></span></a><div class="modal-loading"><div class="modal-loading-bar"></div></div></header><main class="modal-body"><ul class="modal-results modal-ajax-content"></ul></main></div><div class="modal-overlay"></div></div>'}(jQuery),function(u){HexoSearch=function(){SearchService.apply(this,arguments);var n=this;return n.config.endpoint="/content.json",n.cache="",n.contentSearch=function(t,e){var n,s=t.title.trim().toLowerCase(),c=e.trim().toLowerCase().split(" "),r=t.text.trim().toLowerCase(),i=!1,d=-1,l=-1;return""!==s&&""!==r&&u.each(c,function(e,o){var a;n=s.indexOf(o),d=r.indexOf(o),n<0&&d<0?i=!1:(i=!0,d<0&&(d=0),0===e&&(l=d)),i&&(r=t.text.trim(),(e=o=0)<=l?(e=0===(o=Math.max(l-30,0))?Math.min(200,r.length):Math.min(l+170,r.length),a=r.substring(o,e),c.forEach(function(e){var o=new RegExp(e,"gi");a=a.replace(o,"<b>"+e+"</b>")}),t.digest=a):(e=Math.min(200,r.length),t.digest=r.trim().substring(0,e)))}),i},n.buildResultList=function(e,a){var t="";return u.each(e,function(e,o){n.contentSearch(o,a)&&(t+=n.buildResult(o.permalink,o.title,o.digest))}),t},n.query=function(a,e,t){var o;n.cache?(o="",o=(o+=n.buildResultList(n.cache.pages,a))+n.buildResultList(n.cache.posts,a),n.dom.modal_results.html(o),t&&t(n.cache)):u.get(n.config.endpoint,{key:n.config.apiKey,cx:n.config.engineId,q:a,start:e,num:n.config.per_page},function(e,o){"success"!==o||!e||!e.posts&&!e.pages||e.posts.length<1&&e.pages.length<1?n.onQueryError(a,o):(n.cache=e,o="",o=(o+=n.buildResultList(e.pages,a))+n.buildResultList(e.posts,a),n.dom.modal_results.html(o)),t&&t(e)})},n}}(jQuery),new HexoSearch;